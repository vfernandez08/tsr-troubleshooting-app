// recommendations.js â€“ ruleâ€‘based suggestion engine for your Tierâ€‘1 eero tool
// Replace the small demo from v1 with this richer rule set.
// -----------------------------------------------------------------------------
// ðˆððð”ð“ â€“ build a `selections` object as the agent/customer answers the wizard.
// Example:
//   const selections = {
//     connectionType: 'wifi',     // 'wifi' | 'wired'
//     band: '5',                  // '2.4' | '5' | '6'
//     speedBucket: 'sub100',      // 'sub50' | 'sub100' | 'sub300' | 'good'
//     rssi: 'low',                // 'low' | 'good'
//     ethernetLink: '100',        // '100' | '1000' | '2500' | '10000'
//     ssidChanged: true,          // network name recently changed
//     newEero: true,              // node added in last 24 h
//     deviceBandCap: '2.4_only',  // '2.4_only' | 'dual' | '6e'
//     dfsHits: true,              // DFS radar events present
//     event: 'deviceFlapping'     // key Eventâ€‘Stream flag if any
//   };
// -----------------------------------------------------------------------------
// ðŽð”ð“ðð”ð“ â€“ call `getRecommendations(selections)` to receive an array of plainâ€‘
// text fixes ready to render.
// -----------------------------------------------------------------------------

const rules = [
  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Wiâ€‘Fi signal / RSSI â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    when: { connectionType: 'wifi', rssi: 'low' },
    solutions: [
      'Have the customer move the device closer to the nearest eero.',
      'Relocate an eero or add another node midway to boost mesh coverage.',
      'Remove metal/mirrored obstacles that can attenuate 5â€“6Â GHz signal.'
    ]
  },

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Gateway link negotiating at 100Â Mbps â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    when: { ethernetLink: '100' },
    solutions: [
      'Swap the Ethernet patch cord between ONT and gateway (should click firmly).',
      'Verify the upstream port or media converter actually supports â‰¥1Â Gbps.',
      'Inspect the cable run for water ingress, kinks, or bent pins.'
    ]
  },

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Repeated gatewayâ€‘offline events â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    when: { event: 'gatewayOffline' },
    solutions: [
      'Powerâ€‘cycle the gateway eero and ONT in proper order (ONT first).',
      'Check the power outlet / UPS; brownâ€‘outs can cause random reboots.',
      'Try a different eero power adapter to rule out PSU faults.'
    ]
  },

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ DFS radar hits forcing channel switch â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    when: { dfsHits: true },
    solutions: [
      'Disable DFS channels temporarily in Settings â–¶ eero Labs â–¶ DFS.',
      'Reâ€‘site the eero away from radar sources (weather radar, airports).',
      'Use channels 36â€“48 to avoid DFS if near military radars.'
    ]
  },

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Network name (SSID) recently changed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    when: { ssidChanged: true },
    solutions: [
      'Ask customer to â€œforgetâ€ the old SSID on all devices and reconnect.',
      'Update hardâ€‘coded IoT devices (printers, cameras) with the new SSID.',
      'Reboot devices that tend to cache old SSIDs (e.g., Chromecast/FireTV).' 
    ]
  },

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ New eero node just installed â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    when: { newEero: true },
    solutions: [
      'Wait 5Â min for the new node to finish firmware update before testing.',
      'Make sure the new node is >10Â ft from the gateway to avoid RF echo.',
      'If wired backâ€‘haul is unavailable, ensure clear lineâ€‘ofâ€‘sight to another node.'
    ]
  },

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Device limited to 2.4Â GHz only â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    when: { deviceBandCap: '2.4_only' },
    solutions: [
      'Enable â€œLegacy Modeâ€ in the eero app to broadcast a 2.4Â GHzâ€‘only SSID.',
      'Reduce channel width from 40Â MHz to 20Â MHz to minimize interference.',
      'Advise customer that max throughput will cap around 50â€“70Â Mbps on 2.4Â GHz.'
    ]
  },

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Slow speed on 5Â GHz band â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    when: { band: '5', speedBucket: 'sub100' },
    solutions: [
      'Check for DFS hits; force channel 44/80Â MHz where possible.',
      'Verify client NIC supports 802.11ac 80Â MHz; update drivers/firmware.',
      'Relocate microwave ovens or cordless phones that sit on 5Â GHz channels.'
    ]
  },

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Underâ€‘performing Wiâ€‘FiÂ 6E (6Â GHz) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    when: { band: '6', speedBucket: 'sub300' },
    solutions: [
      'Confirm client device actually supports Wiâ€‘FiÂ 6E and WPA3â€‘SAE.',
      'Update client OS and Wiâ€‘Fi drivers; early 6E stacks had throughput bugs.',
      'Reduce distance; 6Â GHz attenuates faster than 5Â GHzâ€”stay within one room.'
    ]
  },

  // â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Device flapping (disconnect/reconnect) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  {
    when: { event: 'deviceFlapping' },
    solutions: [
      'Turn off â€œBand Steeringâ€ for that device to lock it to a single band.',
      'Assign a static IP or DHCP reservation to rule out lease conflicts.',
      'Update device firmware; older IoT sensors often drop when roaming.'
    ]
  }
];

// -----------------------------------------------------------------------------
// Deâ€‘duplicate fixes across multiple matched rules and return them.
export function getRecommendations(selections) {
  return [...new Set(
    rules
      .filter(rule => Object.entries(rule.when).every(([k, v]) => selections[k] === v))
      .flatMap(rule => rule.solutions)
  )];
}

// -----------------------------------------------------------------------------
/* Example usage â€“ remove before production
import { getRecommendations } from './recommendations.js';
const fixes = getRecommendations({
  connectionType: 'wifi',
  rssi: 'low',
  band: '5',
  speedBucket: 'sub100',
  ssidChanged: true
});
console.log(fixes);
*/
